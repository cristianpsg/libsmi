#!/bin/sh
#
# smilint-FORMAT.test --
#
#       smilint test for various input formats.
#
# FORMAT=xxx : 
#   Check `smilint -l9' output for all TESTMIBS read from dumps/xxx/
#   against nominal dumps/smilint-xxx/ output files.
#

FORMAT=`echo $0 | sed -e 's/^.*smilint-\(.*\).test/\1/'`
ACTUALDIR=smilint-${FORMAT}.out
NOMINALDIR=dumps/smilint-${FORMAT}

rm -rf ${ACTUALDIR}
mkdir ${ACTUALDIR}

RC=0
FAILED=""
for mib in ${TESTMIBS} ; do
    echo "comparing \`smilint -l9 dumps/${FORMAT}/$mib' output with ${NOMINALDIR}/*."
    cd ${ACTUALDIR}
    ../../tools/smilint -c/dev/null -l9 ../dumps/${FORMAT}/$mib > $mib 2>&1
    cd ..
    @DIFF@ ${ACTUALDIR}/$mib ${NOMINALDIR}/$mib > ${ACTUALDIR}/$mib.diff
    if [ ! -s ${ACTUALDIR}/$mib.diff ] ; then
	rm ${ACTUALDIR}/$mib.diff
    else
	FAILED=1
    fi
done

if [ "$FAILED" ] ; then
    echo "*** smilint output differs, see ${ACTUALDIR}/*.diff"
    RC=1
fi

exit ${RC}
