#!/bin/sh

FORMAT=smiv2

rm -rf smidump-orig-${FORMAT}.out
mkdir smidump-orig-${FORMAT}.out

RC=0

for mib in ${TESTMIBS} ; do
    echo "comparing \`smidump -f ${FORMAT} $mib' output with ../mibs/ietf/$mib."
    ../tools/smidump -f ${FORMAT} $mib > smidump-orig-${FORMAT}.out/$mib.${FORMAT}

    ./filter < ../mibs/ietf/$mib > smidump-orig-${FORMAT}.out/$mib.orig.filtered
    ./filter < smidump-orig-${FORMAT}.out/$mib.${FORMAT} > smidump-orig-${FORMAT}.out/$mib.${FORMAT}.filtered

    @DIFF@ smidump-orig-${FORMAT}.out/$mib.orig.filtered smidump-orig-${FORMAT}.out/$mib.${FORMAT}.filtered > smidump-orig-${FORMAT}.out/$mib.diff

    WC=`@DIFF@ smidump-orig-${FORMAT}.out/$mib.diff dumps/$mib.${FORMAT}.diff | wc -l`
    if [ $WC -ne 0 ] ; then
	echo "*** smidump -f ${FORMAT} output for $mib differs from dumps/$mib.${FORMAT}."
	echo "*** smidump -f ${FORMAT} $mib output differs unexpectedly from ../mibs/ietf/$mib."
	RC=1
    fi
done

exit ${RC}
