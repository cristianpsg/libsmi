#!/bin/sh

FORMAT=`echo $0 | sed -e 's/^.*smidump-\(.*\).test/\1/'`

rm -rf smidump-${FORMAT}.out
mkdir smidump-${FORMAT}.out

RC=0

for mib in ${TESTMIBS} ; do
    echo "comparing \`smidump -f ${FORMAT} $mib' output with dumps/$mib.${FORMAT}."
    ../tools/smidump -f ${FORMAT} $mib > smidump-${FORMAT}.out/$mib.${FORMAT}
    WC=`@DIFF@ -I smidump --ignore-blank-lines smidump-${FORMAT}.out/$mib.${FORMAT} dumps/$mib.${FORMAT} | wc -l`
    if [ $WC -ne 0 ] ; then
	echo "*** smidump -f ${FORMAT} output differs, for details take a look at"
	echo "*** diff -u dumps/$mib.${FORMAT} smidump-${FORMAT}.out/$mib.${FORMAT}"
	RC=1
    fi
done

exit ${RC}
