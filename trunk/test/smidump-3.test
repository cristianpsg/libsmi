#!/bin/sh

rm -rf smidump-3.out
mkdir smidump-3.out

RC=0

echo "Comparing SMIv2 modules with \`smidump -f smiv2' output..."

for mib in ${TESTMIBS} ; do
    echo $mib
    for d in `echo ${SMIPATH} | tr ':' ' '` ; do
        if [ -f $d/$mib ] ; then break ; fi
    done 
    cat $d/$mib | ./filter > smidump-3.out/$mib.orig
    ../tools/smidump -fsmiv2 $mib | ./filter > smidump-3.out/$mib.smiv2
    WC=`diff smidump-3.out/$mib.orig smidump-3.out/$mib.smiv2 | wc -l`
    # ugly checks ;-/ anyway, this is what we expect...
    if [ $mib = "RMON2-MIB" -a $WC -ne 28 -o \
	 $mib = "IF-MIB" -a $WC -ne 2 -o \
	 $mib = "MAU-MIB" -a $WC -ne 42 -o \
	 $mib = "SNMPv2-MIB" -a $WC -ne 10 ] ; then
	echo "do not see directory smidump-3.out for results on $mib."
        RC=1
    fi
done

exit ${RC}
