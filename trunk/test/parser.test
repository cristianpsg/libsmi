#!/bin/sh

rm -rf parser.out
mkdir parser.out

RC=0
SMIPATH=$SMIPATH:mibs
export SMIPATH

for n in mibs/LIBSMI-TEST-???-MIB ; do
    mib=`basename $n`
    echo -n "Checking $mib. "
    ../tools/smilint -l9 $mib 2>&1 | sed -e 's/mibs\///' > parser.out/$mib.err
    cat mibs/$mib | grep "^$mib:[0-9]*: " > parser.out/$mib.expect
    cmp -s parser.out/$mib.err parser.out/$mib.expect
    if [ $? -ne 0 ] ; then
        RC=1
        echo "unexpected output. see parser.out directory."
    else
        WC=`cat parser.out/$mib.err | wc -l`
	echo $WC " errors/warnings, ok."
    fi
done

exit ${RC}
